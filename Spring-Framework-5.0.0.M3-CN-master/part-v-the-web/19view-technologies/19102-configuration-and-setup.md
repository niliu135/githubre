### 19.10.2 Configuration and setup

Document based views are handled in an almost identical fashion to XSLT views, and the following sections build upon the previous one by demonstrating how the same controller used in the XSLT example is invoked to render the same model as both a PDF document and an Excel spreadsheet \(which can also be viewed or manipulated in Open Office\).

#### Document view definitions

First, let’s amend the views.properties file \(or xml equivalent\) and add a simple view definition for both document types. The entire file now looks like this with the XSLT view shown from earlier:

```
home.(class)=xslt.HomePage
home.stylesheetLocation=/WEB-INF/xsl/home.xslt
home.root=words

xl.(class)=excel.HomePage

pdf.(class)=pdf.HomePage
```

_If you want to start with a template spreadsheet or a fillable PDF form to add your model data to, specify the location as the 'url' property in the view definition_

#### Controller code

The controller code we’ll use remains exactly the same from the XSLT example earlier other than to change the name of the view to use. Of course, you could be clever and have this selected based on a URL parameter or some other logic - proof that Spring really is very good at decoupling the views from the controllers!

#### Subclassing for Excel views

Exactly as we did for the XSLT example, we’ll subclass suitable abstract classes in order to implement custom behavior in generating our output documents. For Excel, this involves writing a subclass of`org.springframework.web.servlet.view.document.AbstractExcelView`\(for Excel files generated by POI\) or`org.springframework.web.servlet.view.document.AbstractJExcelView`\(for JExcelApi-generated Excel files\) and implementing the`buildExcelDocument()`method.

Here’s the complete listing for our POI Excel view which displays the word list from the model map in consecutive rows of the first column of a new spreadsheet:

```java
package excel;

// imports omitted for brevity

public class HomePage extends AbstractExcelView {

	protected void buildExcelDocument(Map model, HSSFWorkbook wb, HttpServletRequest req,
			HttpServletResponse resp) throws Exception {

		HSSFSheet sheet;
		HSSFRow sheetRow;
		HSSFCell cell;

		// Go to the first sheet
		// getSheetAt: only if wb is created from an existing document
		// sheet = wb.getSheetAt(0);
		sheet = wb.createSheet("Spring");
		sheet.setDefaultColumnWidth((short) 12);

		// write a text at A1
		cell = getCell(sheet, 0, 0);
		setText(cell, "Spring-Excel test");

		List words = (List) model.get("wordList");
		for (int i=0; i < words.size(); i++) {
			cell = getCell(sheet, 2+i, 0);
			setText(cell, (String) words.get(i));
		}
	}

}
```

And the following is a view generating the same Excel file, now using JExcelApi:

```java
package excel;

// imports omitted for brevity

public class HomePage extends AbstractJExcelView {

	protected void buildExcelDocument(Map model, WritableWorkbook wb,
			HttpServletRequest request, HttpServletResponse response) throws Exception {

		WritableSheet sheet = wb.createSheet("Spring", 0);

		sheet.addCell(new Label(0, 0, "Spring-Excel test"));

		List words = (List) model.get("wordList");
		for (int i = 0; i < words.size(); i++) {
			sheet.addCell(new Label(2+i, 0, (String) words.get(i)));
		}
	}
}
```

Note the differences between the APIs. We’ve found that the JExcelApi is somewhat more intuitive, and furthermore, JExcelApi has slightly better image-handling capabilities. There have been memory problems with large Excel files when using JExcelApi however.

If you now amend the controller such that it returns`xl`as the name of the view \(`return new ModelAndView("xl", map);`\) and run your application again, you should find that the Excel spreadsheet is created and downloaded automatically when you request the same page as before.

#### Subclassing for PDF views

The PDF version of the word list is even simpler. This time, the class extends`org.springframework.web.servlet.view.document.AbstractPdfView`and implements the`buildPdfDocument()`method as follows:

```java
package pdf;

// imports omitted for brevity

public class PDFPage extends AbstractPdfView {

	protected void buildPdfDocument(Map model, Document doc, PdfWriter writer,
		HttpServletRequest req, HttpServletResponse resp) throws Exception {
		List words = (List) model.get("wordList");
		for (int i=0; i<words.size(); i++) {
			doc.add( new Paragraph((String) words.get(i)));
		}
	}

}
```

Once again, amend the controller to return the`pdf`view with`return new ModelAndView("pdf", map);`, and reload the URL in your application. This time a PDF document should appear listing each of the words in the model map.

